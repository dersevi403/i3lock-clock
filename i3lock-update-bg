#!/bin/sh
set -eu

SCRIPT_DIR="$(CDPATH= cd -- "$(dirname -- "$0")" && pwd)"

export CACHE="${XDG_CACHE_HOME:-$HOME/.cache}/lock"
mkdir -p "$CACHE"

OUT="$CACHE/lock-bg.png"
BLUR=""

unset IN

while getopts "i:o:b:" opt; do
    case "$opt" in
        i) IN="$OPTARG" ;;
        o) OUT="$OPTARG" ;;
        b) BLUR="$OPTARG" ;;
        *)
            echo "usage: $0 [-i input] [-o output] [-b blur]" >&2
            exit 1
            ;;
    esac
done
shift $((OPTIND - 1))

[ $# -gt 0 ] && IN="$1"
[ $# -gt 1 ] && OUT="$2"

if [ -z "${IN:-}" ]; then
    set -- "$SCRIPT_DIR"/sample-bg.*
    IN="$1"
fi

: "${IN:?no input image found}"

. "$SCRIPT_DIR/lib/convert-helper"

box_convert
composite_convert "$IN" "$OUT"
